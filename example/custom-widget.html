<!DOCTYPE html>
<html>
  <head>
    <title>Custom Widget creation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
    <script type="text/javascript" src="../bower_components/d3/d3.js"></script>
    <script type="text/javascript" src="../bower_components/moment/moment.js"></script>
    <script type="text/javascript" src="../bower_components/handlebars/handlebars.js"></script>
    <script type="text/javascript" src="../bower_components/lodash/dist/lodash.js"></script>
    <script type="text/javascript" src="../bower_components/superagent/superagent.js"></script>
    <script type="text/javascript" src="../bower_components/reliefweb.js/lib/reliefweb.js"></script>
    <script type="text/javascript" src="../dist/reliefweb-widgets.js"></script>
    <script type="text/javascript" src="image.template.js"></script>
    <script id="image-template" type="text/x-handlebars-template">
      <img src="{{src}}" />
      <h1><b>{{title}}</b></h1>
    </script>
    <!-- Image widget assets -->
    <style>
      .widget {
        background: #DDDDEC;
        max-width: 800px;
        margin-bottom: 2rem;
        padding: 1rem;
      }

      .widget img {
        width: 100%;
      }

      .widget .credit {
        text-align: right;
      }
    </style>
  </head>
  <body>
    <div id="widget" class="widget"></div>
    <div id="widget2" class="widget"></div>
    <p>This is an example of how to define/render a custom widget.</p>
    <script type="text/javascript">
      // WidgetBase is a building block for building widgets in the frame
      // of ReliefWeb Widgets.
      var WidgetBase = ReliefwebWidgets.helpers.widgetBase;

      // Define a custom constructor to override defaults.
      var ImageWidget = function(opts) {
        var config = {
          title: "Image Widget",
          src: "https://placekitten.com/g/350/150",
          alt: "Cat",
          credit: ""
        };

        opts = (opts) ? opts : {};

        config = _.defaults(opts, config);
        WidgetBase.call(this, config);
      };

      // Inherit WidgetBase methods.
      ImageWidget.prototype = new WidgetBase();

      ImageWidget.prototype.compile = function(elements, next) {
        var title = this.config('title');
        this.config('title', 'Adjusted Title: ' + title);

        this.template(function(content) {
          elements
              .classed('rw-widget', true)
              .html(content);

          next();
        });
      };

      ImageWidget.prototype.link = function(elements) {
        elements.append("p").text("This text added after initial render.");
      };

      // Instigate new instance of ImageWidget, with overridden defaults.
      var imageWidget = new ImageWidget({
        template: Handlebars.templates['image.hbs'],
        credit: "Photo by Placekitten"
      });

      imageWidget.render('#widget');

      // We can also add the widget to the built-in registry and call from there.
      ReliefwebWidgets.addWidgetToRegistry('image', ImageWidget);
      imageWidget = ReliefwebWidgets.widget('image', {
        title: "Another Image Widget",
        template: "#image-template",
        src: 'http://lorempixel.com/400/200/',
        credit: "Photo by LoremPixel"
      });
      imageWidget.render('#widget2');
    </script>
  </body>
</html>